<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VICORE - Inspection Wagon W2</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .spring-image-mock {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            position: relative;
        }
        .spring-image-mock::before {
            content: '';
            position: absolute;
            width: 120px;
            height: 200px;
            border: 8px solid #4a5568;
            border-radius: 60px;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 8px,
                #4a5568 8px,
                #4a5568 12px
            );
        }
        .spring-image-mock::after {
            content: 'Essieu 3 - FL (Front Left) - Confiance: 0.26';
            position: absolute;
            bottom: 20px;
            font-size: 12px;
            background: rgba(0,0,0,0.7);
            padding: 8px 16px;
            border-radius: 4px;
        }
        .zoom-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: var(--accent-cyan);
        }
        .confidence-bar {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 12px 16px;
            border-radius: 8px;
        }
        .confidence-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        .confidence-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-yellow);
        }
        .alert-banner {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--accent-yellow);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .alert-banner-icon {
            font-size: 24px;
        }
        .alert-banner-text {
            flex: 1;
        }
        .alert-banner-title {
            font-weight: 600;
            color: var(--accent-yellow);
        }
        .alert-banner-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <a href="02_system_view.html" class="logo">
                <div class="logo-icon">V</div>
                <span class="logo-text">VICORE</span>
            </a>
            <nav class="nav-tabs">
                <a href="00_alerts_dashboard.html" class="nav-tab">Dashboard</a>
                <a href="02_system_view.html" class="nav-tab active">Train Passes</a>
                <a href="05_audit_trail.html" class="nav-tab">Audit Trail</a>
                <a href="06_rapports.html" class="nav-tab">Rapports</a>
            </nav>
        </div>
        <div class="header-right">
            <!-- Direction Indicator -->
            <div class="direction-indicator nominal" id="directionIndicator" onclick="toggleDirection()" title="Cliquez pour inverser le sens">
                <div class="direction-icon">&#128646;</div>
                <div class="direction-info">
                    <span class="direction-label">Sens circulation</span>
                    <span class="direction-value" id="directionValue">
                        Sortie Tunnel <span class="direction-arrow">&#8594;</span> Quais
                    </span>
                </div>
            </div>
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span>Online</span>
            </div>
            <div class="clock" id="clock">14:35:12</div>
            <div class="lang-switch">
                <button class="lang-btn active">FR</button>
                <button class="lang-btn">EN</button>
            </div>
            <div class="user-menu">
                <div class="user-avatar">JD</div>
                <div class="user-info">
                    <span class="user-name">Jean Dupont</span>
                    <span class="user-role">Superviseur</span>
                </div>
            </div>
            <a href="01_login.html" class="logout-btn">Deconnexion</a>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
        <a href="00_alerts_dashboard.html" class="mobile-nav-item">Dashboard</a>
        <a href="02_system_view.html" class="mobile-nav-item">Train Passes</a>
        <a href="05_audit_trail.html" class="mobile-nav-item">Audit Trail</a>
        <a href="06_rapports.html" class="mobile-nav-item">Rapports</a>
        <div class="mobile-nav-divider"></div>
        <a href="01_login.html" class="mobile-nav-item">Deconnexion</a>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <main class="content full-width">
            <!-- Breadcrumb -->
            <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text-muted);">
                <a href="02_system_view.html" style="color: var(--accent-cyan); text-decoration: none;">Train Pass #28825</a>
                <span>/</span>
                <span>Vehicule 7907</span>
                <span>/</span>
                <span style="color: var(--text-primary);">Essieu 3 - FL (Front Left)</span>
            </div>

            <!-- Alert Banner -->
            <div class="alert-banner">
                <span class="alert-banner-icon">&#9888;</span>
                <div class="alert-banner-text">
                    <div class="alert-banner-title">Ressort necessitant verification</div>
                    <div class="alert-banner-desc">Le systeme a detecte une incertitude sur ce ressort (Confiance: 0.26 - Unchecked). Veuillez verifier visuellement et confirmer le statut.</div>
                </div>
                <button class="btn btn-primary" onclick="openConfirmModal()">Confirmer le statut</button>
            </div>

            <div class="car-view-layout">
                <!-- Wagon Navigation -->
                <nav class="wagon-nav">
                    <a href="#" class="wagon-nav-item ok">
                        <span style="font-weight: 600;">9704</span>
                        <span style="font-size: 10px; color: var(--text-muted);">OK</span>
                    </a>
                    <a href="#" class="wagon-nav-item warning active">
                        <span style="font-weight: 600;">7907</span>
                        <span style="font-size: 10px; color: var(--accent-yellow);">!</span>
                    </a>
                    <a href="#" class="wagon-nav-item ok">
                        <span style="font-weight: 600;">8123</span>
                        <span style="font-size: 10px; color: var(--text-muted);">OK</span>
                    </a>
                    <a href="#" class="wagon-nav-item ok">
                        <span style="font-weight: 600;">8124</span>
                        <span style="font-size: 10px; color: var(--text-muted);">OK</span>
                    </a>
                    <a href="#" class="wagon-nav-item warning">
                        <span style="font-weight: 600;">8125</span>
                        <span style="font-size: 10px; color: var(--accent-yellow);">!</span>
                    </a>
                    <a href="#" class="wagon-nav-item ok">
                        <span style="font-weight: 600;">8126</span>
                        <span style="font-size: 10px; color: var(--text-muted);">OK</span>
                    </a>
                    <a href="#" class="wagon-nav-item ok">
                        <span style="font-weight: 600;">8127</span>
                        <span style="font-size: 10px; color: var(--text-muted);">OK</span>
                    </a>
                    <a href="#" class="wagon-nav-item ok" style="border-left-color: var(--accent-purple);">
                        <span style="font-weight: 600;">8128</span>
                        <span style="font-size: 10px; color: var(--accent-purple);">&#10004;</span>
                    </a>
                </nav>

                <!-- Spring Viewer -->
                <div class="spring-viewer">
                    <div class="viewer-header">
                        <div>
                            <span class="spring-position">Vehicule 7907 - Essieu 3 - FL (Front Left)</span>
                        </div>
                        <span class="spring-status-badge warning">Confiance: 0.26 - Unchecked</span>
                    </div>

                    <div class="image-container">
                        <div class="spring-image-mock">
                            <div class="zoom-indicator">Zoom: 100%</div>
                            <div class="confidence-bar">
                                <div class="confidence-label">Niveau de confiance</div>
                                <div class="confidence-value">26%</div>
                            </div>
                        </div>
                    </div>

                    <div class="image-controls">
                        <div class="control-group">
                            <div class="control-label">Contraste</div>
                            <input type="range" class="slider" value="50">
                        </div>
                        <div class="control-group">
                            <div class="control-label">Luminosite</div>
                            <input type="range" class="slider" value="50">
                        </div>
                        <div class="control-group">
                            <div class="control-label">Zoom</div>
                            <input type="range" class="slider" value="50">
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="nav-btn">&larr; Precedent</button>
                        <a href="04_historique_ressort.html" class="nav-btn" style="text-decoration: none; text-align: center;">Historique</a>
                        <button class="nav-btn">Suivant &rarr;</button>
                    </div>
                </div>

                <!-- Bogie Panel -->
                <div class="bogie-panel">
                    <div class="bogie-info">
                        <div class="bogie-rfid">RFID: ETMR-7907-AMC2B | Coupon: ET-2026-7907</div>
                        <h3 class="bogie-title">Vehicule 7907 - Chargeur</h3>
                        <div style="margin-top: 8px;">
                            <span class="direction-badge nominal" id="directionBadge">&#128646; Sortie Tunnel &#8594; Quais</span>
                        </div>
                    </div>

                    <!-- Conditions de capture -->
                    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                        <div style="font-size: 11px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 10px; font-weight: 600;">Conditions de capture</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span>&#128337;</span>
                                <span style="color: var(--text-secondary);">14:32 (Jour)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span>&#9728;</span>
                                <span style="color: var(--accent-green);">Ensoleille</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span>&#127777;</span>
                                <span style="color: var(--text-secondary);">8Â°C</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span>&#128167;</span>
                                <span style="color: var(--accent-green);">Sec</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span>&#128663;</span>
                                <span style="color: var(--text-secondary);">42 km/h</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span>&#128247;</span>
                                <span style="color: var(--accent-green);">Expo OK</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color); font-size: 11px; color: var(--accent-green); display: flex; align-items: center; gap: 6px;">
                            <span>&#10003;</span>
                            <span>Conditions optimales pour l'analyse</span>
                        </div>
                    </div>

                    <!-- Note: Structure des positions camera par essieu
                         - FL = Front Left (Avant Gauche)
                         - FR = Front Right (Avant Droit)
                         - BL = Back Left (Arriere Gauche)
                         - BR = Back Right (Arriere Droit)
                         - 4 positions camera par essieu
                         - Nombre d'essieux variable selon le type de vehicule
                    -->
                    <div class="bogie-diagram">
                        <div class="bogie-section">
                            <div class="bogie-label">Vehicule 7907 - ETMR-7907-AMC2B</div>

                            <!-- Essieu 1 -->
                            <div style="background: var(--bg-card); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px;">Essieu 1</div>
                                <div style="display: flex; justify-content: space-around; align-items: center;">
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FL - Front Left" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FR - Front Right" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FR</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BL - Back Left" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BR - Back Right" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BR</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Essieu 2 -->
                            <div style="background: var(--bg-card); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px;">Essieu 2</div>
                                <div style="display: flex; justify-content: space-around; align-items: center;">
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FL" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FR" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FR</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BL" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BR" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BR</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Essieu 3 - avec alerte -->
                            <div style="background: var(--bg-card); border-radius: 8px; padding: 12px; margin-bottom: 8px; border: 1px solid var(--accent-yellow);">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px;">Essieu 3 <span style="color: var(--accent-yellow);">&#9888;</span></div>
                                <div style="display: flex; justify-content: space-around; align-items: center;">
                                    <div style="text-align: center;">
                                        <div class="spring-dot warning active" title="FL - ALERTE - Confiance: 0.26" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--accent-yellow); margin-top: 2px;">FL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FR" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FR</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BL" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BR" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BR</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Essieu 4 -->
                            <div style="background: var(--bg-card); border-radius: 8px; padding: 12px;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px;">Essieu 4</div>
                                <div style="display: flex; justify-content: space-around; align-items: center;">
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FL" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="FR" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">FR</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BL" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BL</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div class="spring-dot ok" title="BR" style="width: 20px; height: 20px;"></div>
                                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 2px;">BR</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 20px; background: var(--bg-secondary); padding: 10px; border-radius: 6px;">
                        <strong>Legende - Positions Camera:</strong><br>
                        <span style="color: var(--accent-cyan);">FL</span> = Front Left |
                        <span style="color: var(--accent-cyan);">FR</span> = Front Right |
                        <span style="color: var(--accent-cyan);">BL</span> = Back Left |
                        <span style="color: var(--accent-cyan);">BR</span> = Back Right<br>
                        Cliquez sur un ressort pour afficher son image
                    </div>

                    <a href="02_system_view.html" class="back-link">
                        &larr; Retour a la liste des wagons
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Confirmer le statut du ressort</h3>
                <button class="modal-close" onclick="closeConfirmModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Examinez toutes les images disponibles pour ce ressort et confirmez son statut.
                </p>

                <!-- Image grid -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;">
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--accent-cyan);">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 1</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 2</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 3</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 4</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 5</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 6</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 7</span>
                    </div>
                    <div style="aspect-ratio: 1; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: var(--text-muted); font-size: 12px;">Cam 8</span>
                    </div>
                </div>

                <div style="background: var(--bg-secondary); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                    <strong style="display: block; margin-bottom: 8px;">Informations:</strong>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        <div>Vehicule: 7907 (RFID: ETMR-7907-AMC2B)</div>
                        <div>Position: Essieu 3 - FL (Front Left)</div>
                        <div>Confiance: 0.26 (Unchecked)</div>
                        <div>Detection: 18/01/2026 14:32:47</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Incertain - Fermer</button>
                <button class="btn btn-success" onclick="confirmPresent()">Ressort Present</button>
                <button class="btn btn-danger" onclick="confirmMissing()">Ressort Manquant</button>
            </div>
        </div>
    </div>

    <script>
        // Clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('fr-FR');
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Modal
        function openConfirmModal() {
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function confirmPresent() {
            alert('Ressort confirme PRESENT. Le statut a ete mis a jour.');
            closeConfirmModal();
            window.location.href = '02_system_view.html';
        }

        function confirmMissing() {
            alert('Ressort confirme MANQUANT. Une alerte a ete generee.');
            closeConfirmModal();
            window.location.href = '02_system_view.html';
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const mobileNav = document.getElementById('mobileNav');
            const toggleBtn = document.querySelector('.mobile-menu-toggle');
            mobileNav.classList.toggle('active');
            toggleBtn.classList.toggle('active');
        }

        // Train direction toggle
        let isNominal = true;

        function toggleDirection() {
            isNominal = !isNominal;
            setDirection(isNominal ? 'nominal' : 'inverted');
            localStorage.setItem('trainDirection', isNominal ? 'nominal' : 'inverted');
        }

        function setDirection(mode) {
            const indicator = document.getElementById('directionIndicator');
            const badge = document.getElementById('directionBadge');
            const value = document.getElementById('directionValue');

            if (mode === 'nominal') {
                isNominal = true;
                indicator.classList.remove('inverted');
                indicator.classList.add('nominal');
                badge.classList.remove('inverted');
                badge.classList.add('nominal');
                value.innerHTML = 'Sortie Tunnel <span class="direction-arrow">&#8594;</span> Quais';
                badge.innerHTML = '&#128646; Sortie Tunnel &#8594; Quais';
            } else {
                isNominal = false;
                indicator.classList.remove('nominal');
                indicator.classList.add('inverted');
                badge.classList.remove('nominal');
                badge.classList.add('inverted');
                value.innerHTML = 'Quais <span class="direction-arrow">&#8592;</span> Entree Tunnel';
                badge.innerHTML = '&#128646; Quais &#8592; Entree Tunnel';
            }
        }

        // Load direction state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedDirection = localStorage.getItem('trainDirection') || 'nominal';
            if (savedDirection === 'inverted') {
                setDirection('inverted');
            }
        });
    </script>
</body>
</html>
